# 動画閲覧画面 仕様書

## 1. 概要

動画検索画面から遷移し、選択された動画を再生・閲覧するための画面。HLS形式の動画再生と、タグ一覧表示・タグによる検索機能を提供する。

## 2. 画面遷移

### 2.1 遷移元
- **動画検索画面**: 動画サムネイル（プレビュー）をクリック

### 2.2 遷移先
- **動画検索画面**: タグをクリックして該当タグで検索

## 3. 機能要件

### 3.1 動画再生機能

#### 3.1.1 動画プレーヤー
- **形式**: HLS（HTTP Live Streaming）対応
- **再生制御**:
  - 再生/一時停止
  - シークバー操作
  - 音量調整
  - フルスクリーン対応
- **技術要件**:
  - HLSストリーミングをサポートする動画プレーヤーの実装
  - 既存のファイルストリーミング機能（`src/server/router/file/get.ts`）との連携

### 3.2 タグ表示・操作機能

#### 3.2.1 タグ一覧表示
- **表示内容**: 動画に紐づいているすべてのタグを一覧表示
- **データソース**: Videosテーブルと中間テーブル（Videos-Tags）から取得
- **UI要件**:
  - タグはクリック可能な要素として表示
  - タグごとに視覚的に区別できるデザイン

#### 3.2.2 タグクリック機能
- **動作**: タグをクリック時、動画検索画面へ遷移
- **検索条件**: クリックされたタグで動画を検索
- **実装要件**:
  - `useNavigation`フックを使用した画面遷移
  - タグIDまたはタグ名を検索パラメータとして渡す

## 4. 画面構成

### 4.1 レイアウト
```
+------------------------------------------+
| ナビゲーション                              |
+------------------------------------------+
|                                          |
|        動画プレーヤー（HLS）                 |
|                                          |
+------------------------------------------+
| タグ一覧                                   |
| [タグ1] [タグ2] [タグ3] ...               |
+------------------------------------------+
| 動画情報                                   |
| - タイトル                                 |
| - 作者情報                                 |
+------------------------------------------+
```

### 4.2 UIコンポーネント構成
- **ページコンポーネント**: `src/renderer/pages/video-detail.tsx`（新規作成）
- **動画プレーヤー**: `features/video/ui/VideoPlayer.tsx`（新規作成）
- **タグ一覧**: 既存の`features/tag/ui/tag.input.component.tsx`を参考に実装
- **ナビゲーション**: `features/shared/ui/navigation.client.tsx`を使用

## 5. 技術仕様

### 5.1 ルーティング
- **URL形式**: `/video/:videoId`
- **ルーター設定**: `src/renderer/route.tsx`に追加
- **SSR対応**: `src/server/router/video/detail.tsx`（新規作成）

### 5.2 API連携

#### 5.2.1 動画詳細取得API
```typescript
// src/main/apis/videos/detail.ts（新規作成予定）
export interface VideoDetailResponse {
  id: string;
  title: string;
  filePath: string;
  tags: Array<{ id: string; name: string }>;
  authors: Array<{ id: string; name: string }>;
}
```

#### 5.2.2 ファイルストリーミング
- **既存エンドポイント**: `/file/*`（`src/server/router/file/get.ts`）
- **形式**: HLSマニフェスト（.m3u8）とセグメント（.ts）の配信

### 5.3 データフロー
1. **動画ID取得**: URLパラメータから動画IDを取得
2. **動画情報取得**: APIを通じて動画詳細を取得
3. **HLSファイルパス取得**: 動画ファイルパスからHLSマニフェストのURLを生成
4. **プレーヤー初期化**: HLS.jsなどを使用してプレーヤーを初期化
5. **タグ表示**: 取得したタグ情報を一覧表示

### 5.4 使用技術
- **HLSプレーヤー**: hls.js または video.js（HLSプラグイン付き）
- **状態管理**: React Hooks（useState, useEffect）
- **ルーティング**: React Router DOM 7.9.1
- **ナビゲーション**: `useNavigation`カスタムフック
- **SSR**: Hono + react-hydra-builder

## 6. 非機能要件

### 6.1 パフォーマンス
- **動画読み込み**: HLSストリーミングによる効率的な配信
- **初期表示**: 2秒以内に動画プレーヤーを表示

### 6.2 セキュリティ
- **ファイルアクセス**: 既存のセキュアなファイルストリーミング機能を使用
- **パス検証**: 不正なファイルパスへのアクセスを防止

### 6.3 ユーザビリティ
- **レスポンシブ**: ウィンドウサイズに応じた適切な表示
- **キーボード操作**: 動画再生の基本操作をキーボードで実行可能
- **アクセシビリティ**: スクリーンリーダー対応

## 7. 実装スコープ

### 必須機能
- ✅ 動画ID取得とルーティング設定
- ✅ 動画詳細情報取得API実装
- ✅ 基本的な動画プレーヤー表示（HLS対応）
- ✅ タグ一覧表示
- ✅ タグクリックによる検索画面遷移

## 8. 参考資料

### 8.1 既存実装
- 動画検索画面: `src/server/router/video/search.tsx`
- ファイルストリーミング: `src/server/router/file/get.ts`
- ナビゲーションシステム: `features/shared/ui/navigation.*`
- タグ入力コンポーネント: `features/tag/ui/tag.input.component.tsx`

### 8.2 技術ドキュメント
- HLS.js: https://github.com/video-dev/hls.js
- React Router DOM: https://reactrouter.com/
- Hono: https://hono.dev/

## 9. 備考

- HLSファイルの生成方法については別途検討が必要
- 動画ファイルがHLS形式でない場合の変換処理を検討
- パフォーマンス要件に応じてキャッシュ戦略を検討
