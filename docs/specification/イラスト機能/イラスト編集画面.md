# イラスト編集画面 仕様書

## 1. 概要
イラスト編集画面では、既存イラストに対して画像の追加・削除、並び順変更、タグ・作者情報の編集が可能。

## 2. UI構成

画面は上から順に以下の要素で構成される：

```
┌─────────────────────────────┐
│      ページヘッダー         │
│  イラスト編集               │
└─────────────────────────────┘
┌─────────────────────────────┐
│     基本情報編集            │
│  - タグ選択                 │
│  - 作者選択                 │
└─────────────────────────────┘
┌─────────────────────────────┐
│      画像管理               │
│  [画像1] [画像2] [画像3]   │
│  ↑↓ ✕   ↑↓ ✕   ↑↓ ✕     │
│                             │
│  [+ 新しい画像を追加]       │
└─────────────────────────────┘
┌─────────────────────────────┐
│      操作ボタン             │
│  [保存] [キャンセル]        │
└─────────────────────────────┘
```

### 2.1 基本情報編集
- **タグ選択**: イラストに紐づけるタグを選択/追加/削除
- **作者選択**: イラストの作者を選択

### 2.2 画像管理
- **画像一覧**: 現在登録されている画像をサムネイル表示
- **並び順変更**: 各画像に上下移動ボタンを配置
- **画像削除**: 各画像に削除ボタンを配置
- **画像追加**: 新しい画像をアップロードするボタン

### 2.3 操作ボタン
- **保存**: 変更内容を保存
- **キャンセル**: 変更を破棄して詳細画面へ戻る

## 3. 機能要件

### 3.1 タグ編集
- 既存タグから選択可能
- タグの追加・削除が可能
- 複数タグの設定が可能

### 3.2 作者編集
- 既存作者から選択可能
- 作者選択モーダル/ドロップダウンで選択

### 3.3 画像追加
- **入力**: ローカルファイルから画像を選択
- **形式**: 一般的な画像形式（JPEG, PNG, GIF等）をサポート
- **プレビュー**: アップロード前にプレビュー表示
- **追加位置**: 現在の画像リストの末尾に追加

### 3.4 画像削除
- **確認**: 削除前に確認ダイアログを表示
- **制限**: 最後の1枚は削除不可（イラストには最低1枚の画像が必要）
- **UI状態**: 画像が1枚のみの場合、削除ボタンを非活性化

### 3.5 並び順変更
- **上へ移動**: 現在の位置から1つ上へ移動
- **下へ移動**: 現在の位置から1つ下へ移動
- **UI状態**: 最上位の画像は上へ移動不可、最下位の画像は下へ移動不可
- **即時反映**: 並び順変更はUI上で即座に反映（保存ボタン押下まで確定しない）

### 3.6 保存処理
- すべての変更内容を一括で保存
- バリデーション:
  - 最低1枚の画像が存在すること
  - 作者が選択されていること
- 保存成功後、詳細画面へ遷移

### 3.7 キャンセル処理
- 変更内容を破棄
- 変更がある場合は確認ダイアログを表示
- 詳細画面へ戻る

## 4. 画面遷移

### 4.1 編集画面への遷移
- **遷移元**: イラスト詳細画面の「編集」ボタン
- **パラメータ**: イラストID

### 4.2 保存後の遷移
- **遷移先**: イラスト詳細画面
- **パラメータ**: 編集したイラストのID
- **通知**: 保存完了メッセージを表示

### 4.3 キャンセル時の遷移
- **遷移先**: イラスト詳細画面
- **パラメータ**: 元のイラストのID

## 5. 技術的検討事項

### 5.1 コンポーネント構成（例）
```
IllustEdit/
  ├─ IllustEditForm.tsx        # 編集フォーム全体
  ├─ TagSelector.tsx           # タグ選択UI
  ├─ AuthorSelector.tsx        # 作者選択UI
  ├─ ImageManager.tsx          # 画像管理UI
  ├─ ImageItem.tsx             # 個別画像アイテム
  ├─ ImageUploader.tsx         # 画像アップロード
  └─ EditActionButtons.tsx     # 保存・キャンセルボタン
```

### 5.2 データ構造
```typescript
interface IllustEditData {
  id: string;
  tags: Tag[];
  author: Author;
  images: Image[];
}

interface Image {
  id: string;
  url: string;
  order: number;
  file?: File;  // 新規アップロード時
}
```

### 5.3 状態管理
- イラスト編集データ（タグ、作者、画像リスト）
- 変更フラグ（未保存の変更があるか）
- ローディング状態
- エラー状態
- バリデーション状態

### 5.4 画像並び順の管理
- `order` フィールドで管理
- 上下移動時に `order` 値を入れ替え
- 保存時に `order` 順で画像を送信

### 5.5 ファイルアップロード
- FormData を使用してマルチパート送信
- 画像プレビューは FileReader API を使用
- アップロード進捗表示の検討

## 6. バリデーション

### 6.1 保存前チェック
- [ ] 最低1枚の画像が存在する
- [ ] 作者が選択されている
- [ ] 画像ファイルサイズが制限内（例: 10MB以下/枚）
- [ ] 画像形式が許可されている

### 6.2 エラー表示
- バリデーションエラーは該当フィールド近くに表示
- エラーがある場合、保存ボタンを非活性化

## 7. UX考慮事項

### 7.1 未保存変更の警告
- 変更がある状態でキャンセル/戻る操作時に確認ダイアログ表示
- ブラウザの戻るボタンにも対応（beforeunload）

### 7.2 操作フィードバック
- 画像アップロード中はローディング表示
- 保存処理中はボタン非活性化＋ローディング表示
- 保存成功時はトースト通知

### 7.3 ドラッグ＆ドロップ（将来実装）
- 画像の並び順変更をドラッグ＆ドロップで可能に
- 画像アップロードもドラッグ＆ドロップ対応

## 8. 備考
- 初期実装では上下ボタンによる並び順変更を実装
- ドラッグ＆ドロップは将来的な改善として検討
- 画像の一括アップロードは将来機能として検討
