# å‹•ç”»è¤‡æ•°ç™»éŒ²æ©Ÿèƒ½ å®Ÿè£…çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆ

## å®Œäº†ã—ãŸä½œæ¥­

### âœ… 1. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å¤‰æ›´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `features/video/video.model.ts`

```typescript
// æ–°è¦è¿½åŠ 
export type VideoContent = {
	content: Content;
	order: number;
};

// Videoå‹ã‚’æ›´æ–°
export type Video = {
	id: string;
	previewGifPath: string;
	thumbnailPath: string;
	contents: VideoContent[];  // Content[] â†’ VideoContent[]ã«å¤‰æ›´
	tags: Tag[];
	authors: Author[];
};
```

### âœ… 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `features/shared/database/schema.ts`

```typescript
export const VIDEOS_CONTENTS = sqliteTable(
	"videos_contents",
	{
		videoId: text("video_id")
			.notNull()
			.references(() => VIDEOS.id),
		contentId: text("content_id")
			.notNull()
			.references(() => CONTENTS.id),
		order: integer("order").notNull().default(0),  // è¿½åŠ 
	},
	(table) => [primaryKey({ columns: [table.videoId, table.contentId] })],
);
```

### âœ… 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- `VIDEOS_CONTENTS`ãƒ†ãƒ¼ãƒ–ãƒ«ã«`order`ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: `0`
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ¸ˆã¿

### âœ… 4. Video Actionå¤‰æ›´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `features/video/video.action.ts`

**å¤‰æ›´ç‚¹**:
- `register(tags, content, author)` â†’ `register(tags, contents, authors)`
- è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¯¾å¿œ
- è¤‡æ•°ä½œè€…å¯¾å¿œ
- æœ€åˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ ã‚µãƒ ãƒã‚¤ãƒ«/ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼GIF ã‚’ç”Ÿæˆ
- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ä¸¦ã³é †ï¼ˆorderï¼‰ã‚’ä»˜ä¸

### âœ… 5. Video DataSourceå¤‰æ›´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `features/video/video.datasource.ts`

**å¤‰æ›´ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰**:

1. **save()**: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¿å­˜æ™‚ã«orderæƒ…å ±ã‚’å«ã‚ã‚‹
2. **findById()**:
   - orderã§ã‚½ãƒ¼ãƒˆ
   - VideoContentå‹ã«å¤‰æ›
3. **search()**:
   - orderã§ã‚½ãƒ¼ãƒˆ
   - VideoContentå‹ã«å¤‰æ›
4. **findByAuthorId()**: åŒæ§˜ã®å¤‰æ›´

### âœ… 6. APIå¤‰æ›´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/main/apis/videos/video.register.api.ts`

```typescript
// ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´
export const registerVideoSchema = z.object({
	resourceIds: z.array(z.string()).min(1),  // resourceId â†’ resourceIds
	rawTags: z.string(),
	authorIds: z.array(z.string()).optional(),  // authorId â†’ authorIds
});
```

**å‡¦ç†å¤‰æ›´**:
- è¤‡æ•°ã®æœªç®¡ç†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ«ãƒ¼ãƒ—ã§å–å¾—
- è¤‡æ•°ã®ä½œè€…ã‚’ãƒ«ãƒ¼ãƒ—ã§å–å¾—
- `videoAction.register(tags, contents, authors)`ã‚’å‘¼ã³å‡ºã—

### âœ… 7. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‹ä¿®æ­£
ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§`VideoContent`å‹ã«å¯¾å¿œ:

- `src/renderer/pages/video.detail.page.tsx`
- `src/server/view/pages/video.detail.page.tsx`
- `features/video/ui/templates/video.detail.template.tsx`
- `src/main/apis/authors/author.detail.api.ts`
- `src/server/router/author/detail.tsx`
- `src/server/router/video/register.tsx`
- `tests/api/video/video.detail.api.test.ts`
- `tests/api/video/video.register.api.test.ts`
- `tests/api/video/video.search.api.test.ts`
- `tests/server/video/video.detail.test.tsx`
- `tests/server/video/video.search.test.tsx`

å‹ãƒã‚§ãƒƒã‚¯: âœ… `npm run check` æˆåŠŸ

---

## ğŸ”„ æ®‹ã‚Šã®ä½œæ¥­ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

### 1. VideoContentInputã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `features/video/ui/components/video.content.input.component.tsx` (æ–°è¦ä½œæˆ)

**å‚è€ƒ**: `features/illust/ui/components/illust.content.input.component.tsx`

**å®Ÿè£…å†…å®¹**:
- è¤‡æ•°å‹•ç”»é¸æŠæ©Ÿèƒ½
- ä¸¦ã³æ›¿ãˆæ©Ÿèƒ½ï¼ˆâ†‘â†“ãƒœã‚¿ãƒ³ï¼‰
- å‰Šé™¤æ©Ÿèƒ½
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆvideoã‚¿ã‚°ï¼‰
- æœ€åˆã®å‹•ç”» = ã‚µãƒ ãƒã‚¤ãƒ«/GIFç”Ÿæˆå…ƒã¨ã—ã¦è¡¨ç¤º
- hiddenãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«`resourceIds`ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å‡ºåŠ›

**ä¸»ãªæ©Ÿèƒ½**:
```typescript
- pickupVideo(): å‹•ç”»é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- moveUp(index): é †åºã‚’ä¸Šã«ç§»å‹•
- moveDown(index): é †åºã‚’ä¸‹ã«ç§»å‹•
- removeFile(id): å‹•ç”»å‰Šé™¤
- contentFiles: ContentFile[] çŠ¶æ…‹ç®¡ç†
```

### 2. å‹•ç”»ç™»éŒ²ãƒšãƒ¼ã‚¸æ›´æ–°

#### ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/renderer/pages/video.register.page.tsx`

**å¤‰æ›´ç‚¹**:
- `VideoInput` â†’ `VideoContentInput`ã«ç½®ãæ›ãˆ
- è¤‡æ•°å‹•ç”»å¯¾å¿œã®UI

#### ã‚µãƒ¼ãƒãƒ¼å´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/server/view/pages/video.register.page.tsx`

**å¤‰æ›´ç‚¹**:
- ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’è¤‡æ•°å¯¾å¿œã«

### 3. å‹•ç”»è©³ç´°ãƒšãƒ¼ã‚¸æ›´æ–°ï¼ˆè¤‡æ•°å‹•ç”»è¡¨ç¤ºï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `features/video/ui/templates/video.detail.template.tsx`

**å¤‰æ›´å†…å®¹**:
- è¤‡æ•°å‹•ç”»ã‚’ã‚¿ãƒ–ã¾ãŸã¯ãƒªã‚¹ãƒˆã§åˆ‡ã‚Šæ›¿ãˆè¡¨ç¤º
- å„å‹•ç”»ã«VideoPlayerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é…ç½®
- é †åºè¡¨ç¤ºï¼ˆ1/3, 2/3, 3/3 ãªã©ï¼‰

**UIãƒ‘ã‚¿ãƒ¼ãƒ³æ¡ˆ**:

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ**
```tsx
<div className="tabs">
  {video.contents.map((vc, index) => (
    <button key={vc.content.id}>å‹•ç”» {index + 1}</button>
  ))}
</div>
<VideoPlayer src={currentVideoSrc} />
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: ç¸¦ä¸¦ã³ãƒªã‚¹ãƒˆ**
```tsx
{video.contents.map((vc, index) => (
  <div key={vc.content.id}>
    <h3>å‹•ç”» {index + 1}</h3>
    <VideoPlayer src={`.../${vc.content.path}/index.m3u8`} />
  </div>
))}
```

### 4. æœ€çµ‚ç¢ºèª
- [ ] `npm run check` - å‹ãƒã‚§ãƒƒã‚¯
- [ ] `npm run lint -- --write` - ãƒªãƒ³ãƒˆä¿®æ­£
- [ ] å‹•ç”»ç™»éŒ²ã®E2Eãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•ï¼‰
- [ ] å‹•ç”»è©³ç´°è¡¨ç¤ºã®E2Eãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•ï¼‰

---

## å®Ÿè£…ã®è€ƒæ…®äº‹é …

### ã‚µãƒ ãƒã‚¤ãƒ«/GIFç”Ÿæˆ
- **ä»•æ§˜**: æœ€åˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆorder=0ï¼‰ã‹ã‚‰ç”Ÿæˆ
- **å®Ÿè£…å ´æ‰€**: `VideoAction.register()`
- **ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å…ˆ**: æœ€åˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
- `order`ã¯0ã‹ã‚‰å§‹ã¾ã‚‹é€£ç•ª
- å‰Šé™¤ãƒ»ä¸¦ã³æ›¿ãˆæ™‚ã¯è‡ªå‹•ã§orderå†è¨ˆç®—
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜æ™‚ã«orderã‚’å¿…ãšå«ã‚ã‚‹

### UI/UX
- æœ€åˆã®å‹•ç”»ãŒç‰¹åˆ¥æ‰±ã„ï¼ˆã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆå…ƒï¼‰ã‚’æ˜ç¤º
- ä¸¦ã³æ›¿ãˆã¯ç›´æ„Ÿçš„ï¼ˆâ†‘â†“ãƒœã‚¿ãƒ³ï¼‰
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å‹•ç”»å†…å®¹ã‚’ç¢ºèªå¯èƒ½

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã¯é…å»¶èª­ã¿è¾¼ã¿
- ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºã‚’å„ªå…ˆ
- è¤‡æ•°å‹•ç”»ã§ã‚‚ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã‚’è€ƒæ…®

---

## å‚è€ƒ: Illustã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

å‹•ç”»è¤‡æ•°ç™»éŒ²ã¯ã€ã‚¤ãƒ©ã‚¹ãƒˆè¤‡æ•°ç™»éŒ²ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

### å…±é€šç‚¹
- `IllustContent` / `VideoContent`å‹
- `order`ã‚«ãƒ©ãƒ ã§ã‚½ãƒ¼ãƒˆ
- `content`ã¨`order`ã‚’ã‚»ãƒƒãƒˆã§ç®¡ç†
- è¤‡æ•°é¸æŠUIï¼ˆä¸¦ã³æ›¿ãˆãƒ»å‰Šé™¤æ©Ÿèƒ½ï¼‰

### ç›¸é•ç‚¹
| é …ç›® | Illust | Video |
|------|--------|-------|
| ãƒ¡ãƒ‡ã‚£ã‚¢ç”Ÿæˆ | ãªã— | ã‚µãƒ ãƒã‚¤ãƒ«/GIFç”Ÿæˆã‚ã‚Š |
| ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ | img | video |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º | å° | å¤§ |

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **VideoContentInputã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ**
   - `IllustContentInput`ã‚’ãƒ™ãƒ¼ã‚¹ã«å‹•ç”»ç”¨ã«èª¿æ•´
   - `pickupVideo()`ã§è¤‡æ•°é¸æŠå¯¾å¿œ
   - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’`<video>`ã‚¿ã‚°ã«

2. **å‹•ç”»ç™»éŒ²ãƒšãƒ¼ã‚¸çµ±åˆ**
   - æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿è¾¼ã¿
   - ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†ã‚’ç¢ºèª

3. **å‹•ç”»è©³ç´°ãƒšãƒ¼ã‚¸UIæ”¹å–„**
   - è¤‡æ•°å‹•ç”»è¡¨ç¤ºã®UIå®Ÿè£…
   - åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½è¿½åŠ 

4. **ãƒ†ã‚¹ãƒˆã¨æ¤œè¨¼**
   - å‹ãƒã‚§ãƒƒã‚¯
   - ãƒªãƒ³ãƒˆ
   - æ‰‹å‹•E2Eãƒ†ã‚¹ãƒˆ

---

## ä½œæ¥­æ™‚é–“ã®è¦‹ç©ã‚‚ã‚Š

- VideoContentInputã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: 30åˆ†
- å‹•ç”»ç™»éŒ²ãƒšãƒ¼ã‚¸æ›´æ–°: 15åˆ†
- å‹•ç”»è©³ç´°ãƒšãƒ¼ã‚¸æ›´æ–°: 30åˆ†
- ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°: 30åˆ†

**åˆè¨ˆ**: ç´„2æ™‚é–“
