# イラスト検索画面 簡易仕様書

## 1. 概要

イラストを検索・閲覧するための画面。タグによる検索、ページネーション、ソート機能を提供する。

## 2. データモデル

### 2.1 テーブル定義（schema.tsベース）

#### ILLUSTS（イラスト）
```typescript
{
  id: string; // PK
}
```

#### CONTENTS（コンテンツ）
```typescript
{
  id: string;   // PK
  path: string; // ファイルパス
  name: string; // ファイル名
  hash: string; // ファイルハッシュ
}
```

#### TAGS（タグ）
```typescript
{
  id: string;   // PK
  name: string; // unique
}
```

#### AUTHORS（作者）
```typescript
{
  id: string;                       // PK
  name: string;
  urls: Record<string, string>;     // JSON形式のURL一覧
}
```

#### ILLUSTS_CONTENTS（イラスト-コンテンツ中間テーブル）
```typescript
{
  illustId: string;  // FK → ILLUSTS.id
  contentId: string; // FK → CONTENTS.id
  order: number;     // 表示順序
}
// PK: (illustId, contentId)
```

#### ILLUSTS_TAGS（イラスト-タグ中間テーブル）
```typescript
{
  illustId: string; // FK → ILLUSTS.id
  tagId: string;    // FK → TAGS.id
}
// PK: (illustId, tagId)
```

#### ILLUSTS_AUTHORS（イラスト-作者中間テーブル）
```typescript
{
  illustId: string; // FK → ILLUSTS.id
  authorId: string; // FK → AUTHORS.id
}
// PK: (illustId, authorId)
```

### 2.2 検索結果の結合データ型

```typescript
interface IllustSearchResult {
  id: string;
  contents: Array<{
    id: string;
    path: string;
    name: string;
    hash: string;
    order: number;
  }>;
  tags: Array<{
    id: string;
    name: string;
  }>;
  authors: Array<{
    id: string;
    name: string;
    urls: Record<string, string>;
  }>;
}
```

## 3. 機能要件

### 3.1 検索機能

- **検索対象**: タグ (TAGS.name)
- **検索方式**: 前方部分一致
- **検索入力**: テキストボックス
- **検索実行**: リアルタイム検索または検索ボタン押下

#### 検索ロジック

```sql
-- タグ名で前方一致検索
SELECT DISTINCT i.*
FROM illusts i
JOIN illusts_tags it ON i.id = it.illust_id
JOIN tags t ON it.tag_id = t.id
WHERE t.name LIKE ?1 || '%'
```

### 3.2 ソート機能

- **ソート項目**: イラストID (ILLUSTS.id)
- **ソート順**: 昇順・降順切り替え可能
- **デフォルト**: 降順（新しい順）

**注**: 現在のスキーマにはcreatedAt/updatedAtが未実装のため、IDでソート

### 3.3 ページネーション

- **1ページあたりの表示件数**: 20件（設定可能）
- **ページ送り**: 前へ・次へボタン、ページ番号直接指定
- **総件数表示**: 「全○○件中 △△-□□件を表示」

## 4. UI要件

### 4.1 レイアウト

```
┌─────────────────────────────────────┐
│ 検索バー [           ] [検索]      │
│ ソート: [ID降順▼] 表示件数: [20▼] │
├─────────────────────────────────────┤
│ ┌────┐ ┌────┐ ┌────┐ ┌────┐       │
│ │    │ │    │ │    │ │    │       │
│ │ 🖼️│ │ 🖼️│ │ 🖼️│ │ 🖼️│       │
│ │ 📚 │ │    │ │    │ │ 📚 │       │
│ └────┘ └────┘ └────┘ └────┘       │
│                                     │
│ [<] 1 2 3 4 5 [>]                  │
└─────────────────────────────────────┘
```

### 4.2 サムネイル表示

- **表示画像**: ILLUSTS_CONTENTS.orderが最小のコンテンツ
- **画像パス**: CONTENTS.path（ローカルファイルパス）
- **アスペクト比**: 1:1 または 4:3（統一）
- **画像サイズ**: 200x200px 程度
- **複数画像インジケーター**: 右下に「📚」アイコンまたは枚数表示
  - 条件: コンテンツ数 > 1
  - 表示内容: 「+3」（残り枚数）など

### 4.3 カード情報表示

各イラストカードに表示する情報：

- サムネイル画像（order最小のコンテンツ）
- タグ（最大3つまで表示、それ以上は「+N」）
- 作者名（最大2名まで表示、それ以上は「+N」）
- 複数画像インジケーター

### 4.4 インタラクション

- **カードクリック**: 詳細画面へ遷移（`/illusts/:id`）
- **タグクリック**: そのタグで検索
- **作者名クリック**: その作者で検索（将来対応）

## 5. API要件

### 5.1 検索API

```typescript
GET /api/illusts/search

Query Parameters:
- tag?: string              // 検索ワード（タグの前方一致）
- sortBy?: 'id'             // ソート項目（現在はIDのみ）
- order?: 'asc' | 'desc'    // ソート順
- page?: number             // ページ番号（1始まり）
- limit?: number            // 1ページあたりの件数

Response:
{
  items: IllustSearchResult[];
  total: number;
  page: number;
  limit: number;
  hasNext: boolean;
  hasPrev: boolean;
}
```

### 5.2 データ取得の考慮事項

- ILLUSTS_CONTENTSからorderでソートしてコンテンツを取得
- 複数のJOINを効率化するため、適切なインデックス設定が必要
- サムネイル用には最小orderのコンテンツのみ取得で効率化可能

## 6. 技術仕様

### 6.1 パフォーマンス要件

- 検索結果表示: 500ms以内
- ページ遷移: 300ms以内
- 画像読み込み: Lazy loading対応

### 6.2 レスポンシブ対応

- PC: グリッド 4列
- タブレット: グリッド 3列
- スマートフォン: グリッド 2列

### 6.3 アクセシビリティ

- キーボードナビゲーション対応
- スクリーンリーダー対応
- 適切なARIAラベル設定

## 7. 関連画面

- **イラスト登録画面**: 新規イラスト作成
- **イラスト編集画面**: 既存イラスト編集
- **イラスト詳細画面**: 全画像表示、詳細情報表示

## 8. 制約事項・注意点

- タグ検索は前方一致のみ。部分一致は今後の拡張対応
- 複数タグでのAND/OR検索は今後の拡張対応
- 画像パスはローカルファイルシステムのパス
- createdAt/updatedAtが未実装のため、IDでソート
- 画像フォーマット: JPEG, PNG, WebP対応
- 最大画像サイズ: 10MB/枚
- コンテンツ枚数制限: 50枚/イラスト

## 9. 今後の拡張予定

- createdAt/updatedAtの実装と日付ソート
- 複数タグ検索（AND/OR条件）
- 作者検索
- お気に入り機能
- タグのサジェスト機能
- 検索履歴
- title/descriptionフィールドの追加（任意）
