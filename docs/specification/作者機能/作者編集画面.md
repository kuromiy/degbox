# 作者編集画面 仕様書

## 1. 概要

既存作者の情報を編集するための画面。作者名と外部リンク（URLs）を更新する。

## 2. URL

- **パス**: `/author/:authorId/edit`
- **パスパラメータ**:
  - `authorId`: 編集対象の作者ID

## 3. 画面遷移

### 遷移元
- 作者詳細画面の「編集」ボタン

### 遷移先
- **作者詳細画面**: 更新成功後 → `/author/:authorId`
- **作者詳細画面**: 「キャンセル」ボタンをクリック → `/author/:authorId`

## 4. 機能要件

### 4.1 初期表示

1. URLパラメータから作者IDを取得
2. 作者詳細取得APIを呼び出し、既存データを取得
3. フォームに既存データを初期表示
   - 作者名フィールドに既存の作者名を設定
   - URLフィールドに既存のURLsを設定

### 4.2 入力項目

#### 作者名（必須）
- **タイプ**: テキスト入力
- **バリデーション**: 1文字以上、255文字以下
- **初期値**: 既存の作者名
- **エラーメッセージ**:
  - 空欄: 「作者名を入力してください」
  - 255文字超過: 「作者名は255文字以内で入力してください」

#### 外部リンク（URLs）（オプション）
- **タイプ**: 動的フィールド（キー・バリューペア）
- **初期値**: 既存のURLs
- **キー**: サービス名（例: "twitter", "youtube", "official"）
- **値**: URL（例: "https://twitter.com/username"）
- **バリデーション**:
  - URL形式（http/https）
  - キーと値の両方が入力されている場合のみ登録
- **動作**:
  - 「追加」ボタンで新しいURLフィールドを追加
  - 「削除」ボタンでそのURLフィールドを削除

### 4.3 操作

- **「更新」ボタン**:
  - バリデーションを実行
  - 成功したら作者更新APIを呼び出し
  - 成功したら作者詳細画面へリダイレクト

- **「キャンセル」ボタン**:
  - 入力内容を破棄
  - 作者詳細画面へ戻る

## 5. 画面レイアウト

```
+------------------------------------------+
| ナビゲーション                              |
+------------------------------------------+
| 作者編集                                   |
+------------------------------------------+
| 作者名 (必須)                              |
| [____________________]                   |
|                                          |
| 外部リンク (オプション)                     |
| [キー] [URL]                [追加]        |
| twitter  https://...        [削除]       |
| youtube  https://...        [削除]       |
|                                          |
| [更新] [キャンセル]                        |
+------------------------------------------+
```

## 6. 技術仕様

### 6.1 ルーティング

- **URL**: `/author/:authorId/edit`
- **パスパラメータ**:
  - `authorId`: 編集対象の作者ID

### 6.2 API

#### 作者詳細取得API（初期表示用）

**エンドポイント**: `src/main/apis/authors/detail.ts`

**レスポンス**:
```typescript
export interface AuthorDetailResponse {
  id: string;
  name: string;
  urls: Record<string, string>;
  videos: {
    count: number;
    result: Array<{
      id: string;
      title: string;
      thumbnailPath?: string;
      createdAt: string;
    }>;
    page: number;
    size: number;
  };
}
```

#### 作者更新API

**エンドポイント**: `src/main/apis/authors/update.ts`（新規作成予定）

**リクエスト**:
```typescript
export interface AuthorUpdateRequest {
  id: string;
  name: string;
  urls?: Record<string, string>;
}
```

**レスポンス**:
```typescript
export interface AuthorUpdateResponse {
  id: string;
  name: string;
  urls: Record<string, string>;
}
```

### 6.3 UIコンポーネント

- **ページコンポーネント**: `src/renderer/pages/author.edit.page.tsx`（新規作成）
- **フォームコンポーネント**: `features/author/ui/components/author.form.tsx`（再利用）
  - 作者登録画面と作者編集画面で共有
  - `mode`プロパティで「作成」「編集」を切り替え

### 6.4 状態管理

```typescript
const [name, setName] = useState("");
const [urls, setUrls] = useState<Record<string, string>>({});
const [errors, setErrors] = useState<{name?: string; urls?: string}>({});
const [loading, setLoading] = useState(true);

// 初期データの取得
useEffect(() => {
  const fetchAuthor = async () => {
    const response = await client.getAuthorDetail(authorId);
    if (isSuccess(response)) {
      setName(response.value.name);
      setUrls(response.value.urls);
    }
    setLoading(false);
  };
  fetchAuthor();
}, [authorId]);
```

### 6.5 フォームの共通化

作者登録画面と作者編集画面でフォームコンポーネントを共有:

```typescript
interface AuthorFormProps {
  mode: "create" | "edit";
  initialData?: {
    name: string;
    urls: Record<string, string>;
  };
  onSubmit: (data: { name: string; urls: Record<string, string> }) => void;
  onCancel: () => void;
}
```

## 7. バリデーション

### クライアント側バリデーション

作者登録画面と同じバリデーションロジックを使用。

```typescript
const validate = () => {
  const newErrors: {name?: string; urls?: string} = {};

  // 作者名
  if (!name.trim()) {
    newErrors.name = "作者名を入力してください";
  } else if (name.length > 255) {
    newErrors.name = "作者名は255文字以内で入力してください";
  }

  // URLs
  for (const [key, value] of Object.entries(urls)) {
    if (value && !value.match(/^https?:\/\/.+/)) {
      newErrors.urls = "URLは http:// または https:// で始まる必要があります";
      break;
    }
  }

  setErrors(newErrors);
  return Object.keys(newErrors).length === 0;
};
```

### サーバー側バリデーション

- 作者名の必須チェック
- 作者名の長さチェック（255文字以内）
- URLの形式チェック
- 作者IDの存在チェック

## 8. エラーハンドリング

- **作者が存在しない**: 404エラーページを表示
- **初期データ取得失敗**: エラーメッセージを表示
- **バリデーションエラー**: フォーム内に赤文字でエラーメッセージを表示
- **API失敗**: 「更新に失敗しました」とトーストメッセージを表示
- **ネットワークエラー**: リトライボタンを表示

## 9. 成功時の動作

1. 作者更新APIを呼び出し
2. `/author/:authorId`へリダイレクト
3. 「作者情報を更新しました」とトーストメッセージを表示

## 10. ローディング状態

- **初期データ取得中**: スケルトンまたはスピナーを表示
- **更新中**: 「更新」ボタンを無効化し、ローディングインジケーターを表示

## 11. パフォーマンス要件

- **初期表示**: 1秒以内にフォームを表示
- **更新処理**: 1秒以内にレスポンス

## 12. アクセシビリティ

- 必須フィールドに`required`属性
- エラーメッセージとフィールドを関連付け（`aria-describedby`）
- キーボードナビゲーション対応
- フォーカス管理（エラー時は最初のエラーフィールドにフォーカス）
- ローディング中は適切な`aria-busy`属性を設定
