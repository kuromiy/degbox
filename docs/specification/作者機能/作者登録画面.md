# 作者登録画面 仕様書

## 1. 概要

新規作者を登録するための画面。作者名と外部リンク（URLs）を入力して登録する。

## 2. URL

- **パス**: `/author/register`

## 3. 画面遷移

### 遷移元
- 作者検索画面の「新規作成」ボタン

### 遷移先
- **作者詳細画面**: 登録成功後 → `/author/:authorId`（新規作成した作者の詳細画面）
- **作者検索画面**: 「キャンセル」ボタンをクリック → `/author/search`

## 4. 機能要件

### 4.1 入力項目

#### 作者名（必須）
- **タイプ**: テキスト入力
- **バリデーション**: 1文字以上、255文字以下
- **エラーメッセージ**:
  - 空欄: 「作者名を入力してください」
  - 255文字超過: 「作者名は255文字以内で入力してください」

#### 外部リンク（URLs）（オプション）
- **タイプ**: 動的フィールド（キー・バリューペア）
- **キー**: サービス名（例: "twitter", "youtube", "official"）
- **値**: URL（例: "https://twitter.com/username"）
- **バリデーション**:
  - URL形式（http/https）
  - キーと値の両方が入力されている場合のみ登録
- **動作**:
  - 「追加」ボタンで新しいURLフィールドを追加
  - 「削除」ボタンでそのURLフィールドを削除

### 4.2 操作

- **「登録」ボタン**:
  - バリデーションを実行
  - 成功したら作者登録APIを呼び出し
  - 成功したら作者詳細画面へリダイレクト

- **「キャンセル」ボタン**:
  - 入力内容を破棄
  - 作者検索画面へ戻る

## 5. 画面レイアウト

```
+------------------------------------------+
| ナビゲーション                              |
+------------------------------------------+
| 作者登録                                   |
+------------------------------------------+
| 作者名 (必須)                              |
| [____________________]                   |
|                                          |
| 外部リンク (オプション)                     |
| [キー] [URL]                [追加]        |
| twitter  https://...        [削除]       |
| youtube  https://...        [削除]       |
|                                          |
| [登録] [キャンセル]                        |
+------------------------------------------+
```

## 6. 技術仕様

### 6.1 ルーティング

- **URL**: `/author/register`

### 6.2 API

#### 作者登録API

**エンドポイント**: `src/main/apis/authors/author.register.api.ts`

**リクエスト**:
```typescript
export interface RegisterAuthorRequest {
  name: string;
  urls: string; // JSON文字列形式のRecord<string, string>
}
```

**レスポンス**:
```typescript
// ジョブキューに登録されるため、即座にレスポンスは返らない
// 登録成功時はページリダイレクトで処理
```

### 6.3 UIコンポーネント

- **ページコンポーネント**: `src/renderer/pages/author.register.page.tsx`
- **テンプレートコンポーネント**: `features/author/ui/templates/author.register.template.tsx`
- **サーバールート**: `src/server/router/author/register.tsx`

### 6.4 状態管理

```typescript
const [name, setName] = useState("");
const [urls, setUrls] = useState<Record<string, string>>({});
const [errors, setErrors] = useState<{name?: string; urls?: string}>({});
```

### 6.5 URLフィールドの動的追加・削除

```typescript
// URL追加
const addUrl = () => {
  setUrls({ ...urls, "": "" }); // 空のキー・バリューを追加
};

// URL削除
const removeUrl = (key: string) => {
  const newUrls = { ...urls };
  delete newUrls[key];
  setUrls(newUrls);
};

// URL更新
const updateUrl = (oldKey: string, newKey: string, value: string) => {
  const newUrls = { ...urls };
  delete newUrls[oldKey];
  newUrls[newKey] = value;
  setUrls(newUrls);
};
```

## 7. バリデーション

### クライアント側バリデーション

```typescript
const validate = () => {
  const newErrors: {name?: string; urls?: string} = {};

  // 作者名
  if (!name.trim()) {
    newErrors.name = "作者名を入力してください";
  } else if (name.length > 255) {
    newErrors.name = "作者名は255文字以内で入力してください";
  }

  // URLs
  for (const [key, value] of Object.entries(urls)) {
    if (value && !value.match(/^https?:\/\/.+/)) {
      newErrors.urls = "URLは http:// または https:// で始まる必要があります";
      break;
    }
  }

  setErrors(newErrors);
  return Object.keys(newErrors).length === 0;
};
```

### サーバー側バリデーション

- 作者名の必須チェック
- 作者名の長さチェック（255文字以内）
- URLの形式チェック

## 8. エラーハンドリング

- **バリデーションエラー**: フォーム内に赤文字でエラーメッセージを表示
- **API失敗**: 「登録に失敗しました」とトーストメッセージを表示
- **ネットワークエラー**: リトライボタンを表示

## 9. 成功時の動作

1. 作者登録APIを呼び出し
2. レスポンスから作者IDを取得
3. `/author/:authorId`へリダイレクト
4. 「作者を登録しました」とトーストメッセージを表示

## 10. パフォーマンス要件

- **フォーム表示**: 即座に表示
- **登録処理**: 1秒以内にレスポンス

## 11. アクセシビリティ

- 必須フィールドに`required`属性
- エラーメッセージとフィールドを関連付け（`aria-describedby`）
- キーボードナビゲーション対応
- フォーカス管理（エラー時は最初のエラーフィールドにフォーカス）
