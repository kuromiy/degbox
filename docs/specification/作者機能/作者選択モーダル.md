# 作者選択モーダル 仕様書

## 1. 概要

ビデオ登録時に作者を選択するためのモーダルダイアログ。

## 2. 表示元

- ビデオ登録画面
- ビデオ編集画面（将来的に）

## 3. 機能要件

### 3.1 表示内容

#### 作者検索フィールド
- **タイプ**: テキスト入力
- **機能**: インクリメンタルサーチ（リアルタイム検索）
- **動作**:
  - 入力に応じて作者一覧をフィルタリング
  - デバウンス処理（300ms）で検索APIを呼び出し

#### 作者一覧
- **表示項目**:
  - 作者名
  - ラジオボタンまたはチェックボックス（単一選択）
- **スクロール**: 一覧が長い場合はスクロール可能
- **選択状態**: 現在選択中の作者をハイライト表示

### 3.2 操作

#### 作者選択
1. 作者一覧から作者を選択
2. 「選択」ボタンをクリック
3. 選択した作者がビデオ登録フォームに反映される
4. モーダルが閉じる

#### キャンセル
- 「キャンセル」ボタンまたはモーダル外をクリック
- モーダルが閉じ、選択内容は反映されない

## 4. 画面レイアウト

```
+------------------------------------------+
| 作者選択                                   |
+------------------------------------------+
| 検索: [___________]                       |
+------------------------------------------+
| 作者一覧                                   |
| ( ) 作者1                                 |
| ( ) 作者2                                 |
| ( ) 作者3                                 |
| ...                                      |
+------------------------------------------+
| [選択] [キャンセル]                        |
+------------------------------------------+
```

## 5. 技術仕様

### 5.1 API

#### 作者検索API（インクリメンタルサーチ用）

**エンドポイント**: `src/main/apis/authors/search.ts`

**リクエスト**:
```typescript
export interface AuthorSearchRequest {
  name?: string;
  page?: number;
  size?: number;
}
```

**レスポンス**:
```typescript
export interface AuthorSearchResponse {
  count: number;
  result: Array<{
    id: string;
    name: string;
    urls: Record<string, string>;
    videoCount: number;
  }>;
  page: number;
  size: number;
}
```

### 5.2 UIコンポーネント

- **モーダルコンポーネント**: `features/author/ui/components/author.select.modal.tsx`（新規作成）
- **作者一覧**: `features/author/ui/components/author.list.tsx`（新規作成）

### 5.3 状態管理

```typescript
const [isOpen, setIsOpen] = useState(false);
const [searchQuery, setSearchQuery] = useState("");
const [authors, setAuthors] = useState<Author[]>([]);
const [selectedAuthor, setSelectedAuthor] = useState<Author | null>(null);

// デバウンス処理
const debouncedSearch = useDebounce(searchQuery, 300);

useEffect(() => {
  if (debouncedSearch) {
    searchAuthors(debouncedSearch);
  }
}, [debouncedSearch]);
```

### 5.4 モーダルの開閉

```typescript
interface AuthorSelectModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSelect: (author: Author) => void;
}
```

### 5.5 インクリメンタルサーチ

```typescript
const searchAuthors = async (query: string) => {
  const response = await client.searchAuthor(query, 1, 20);
  if (isSuccess(response)) {
    setAuthors(response.value.result);
  }
};
```

## 6. バリデーション

- 作者が選択されていることを確認（「選択」ボタン押下時）

## 7. エラーハンドリング

- **検索失敗**: 「検索に失敗しました」と表示
- **ネットワークエラー**: リトライボタンを表示

## 8. ユーザビリティ

### キーボード操作
- **Escape**: モーダルを閉じる
- **Enter**: 選択中の作者を確定（作者一覧フォーカス時）
- **矢印キー**: 作者一覧の選択を移動

### フォーカス管理
- モーダル表示時: 検索フィールドにフォーカス
- モーダル閉じる時: 元のフィールド（ビデオ登録フォームの作者フィールド）にフォーカスを戻す

### アクセシビリティ
- `role="dialog"`
- `aria-modal="true"`
- `aria-labelledby`: モーダルタイトル
- `aria-describedby`: モーダル説明文
- フォーカストラップ（モーダル内でのみフォーカス移動）

## 9. パフォーマンス要件

- **モーダル表示**: 即座に表示
- **検索レスポンス**: 300ms以内（デバウンス後）

## 10. ビデオ登録画面との統合

### ビデオ登録フォームでの使用例

```typescript
const [selectedAuthor, setSelectedAuthor] = useState<Author | null>(null);
const [isAuthorModalOpen, setIsAuthorModalOpen] = useState(false);

return (
  <div>
    <label>作者</label>
    <div>
      {selectedAuthor ? (
        <div>
          {selectedAuthor.name}
          <button onClick={() => setIsAuthorModalOpen(true)}>変更</button>
        </div>
      ) : (
        <button onClick={() => setIsAuthorModalOpen(true)}>作者を選択</button>
      )}
    </div>

    <AuthorSelectModal
      isOpen={isAuthorModalOpen}
      onClose={() => setIsAuthorModalOpen(false)}
      onSelect={(author) => {
        setSelectedAuthor(author);
        setIsAuthorModalOpen(false);
      }}
    />
  </div>
);
```

## 11. デバウンス実装例

```typescript
function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}
```
